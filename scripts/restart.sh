#!/bin/bash

# 切换到项目根目录
cd "$(dirname "$0")/.."

echo "========================================"
echo "  智批 - 重启脚本"
echo "========================================"
echo ""

# ==================== 1. 拉取最新代码 ====================

echo "[1/3] 拉取远端最新代码..."
git pull origin main

if [ $? -ne 0 ]; then
    echo "[错误] Git pull 失败"
    echo "请检查："
    echo "  1. 网络连接是否正常"
    echo "  2. 是否有未提交的本地修改"
    echo "  3. 远程仓库地址是否正确"
    echo ""
    exit 1
fi

echo "✓ 代码更新成功"
echo ""

# ==================== 2. 停止服务 ====================

echo "[2/3] 停止现有服务..."
./scripts/stop.sh

if [ $? -ne 0 ]; then
    echo "[警告] 停止服务时出现问题，继续启动新服务..."
fi

echo ""

# ==================== 3. 启动服务 ====================

echo "[3/3] 启动服务..."
./scripts/start.sh

if [ $? -ne 0 ]; then
    echo "[错误] 服务启动失败"
    exit 1
fi

echo ""
echo "========================================"
echo "  重启完成！"
echo "========================================"
echo ""
